#!/bin/bash

[ -e /tmp/motion_saver.pid ] && echo "already running" && exit 1
echo "$$" > /tmp/motion_saver.pid

function onScreenLock {
    motion 2> /dev/null
}

function onScreenUnlock {
    /etc/init.d/motion stop 1> /dev/null
}

dbus-monitor --session "type='signal',interface='org.gnome.ScreenSaver'" |
(
    while true
    do
        read X
        state=`echo $X | grep "boolean " | awk '{print $2;}'`

        if [[ $state == "true" ]]
          then onScreenLock
        elif [[ $state == "false" ]]
          then onScreenUnlock
        fi
    done
)
